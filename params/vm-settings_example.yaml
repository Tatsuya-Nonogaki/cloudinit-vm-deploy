# Example vm-settings.yaml for cloudinit-linux-vm-deploy.ps1

# == Infrastructure (vCenter Connection) ==
# If vcenter_user/vcenter_password are blank or omitted,
# the script will look for cached credentials via New-VICredentialStoreItem.
vcenter_host: vcenter01.backyard.local
vcenter_user: administrator@vsphere.local   # Single Sign-On (SSO) user. Example: administrator@vsphere.local
vcenter_password: "KenFiat50s^"             # SSO password. "" or omit to use credential store.

# == VM Hardware/Placement ==
template_vm_name: rhel9-tpl
new_vm_name: original01
datacenter_name: VMDATACENTER
cluster_name: CLST_A
datastore_name: ProdStore
seed_iso_copy_store: "[COMMSTORE01] cloudinit-iso/"   # Datastore and path where seed ISO will be copied temporarily, in a form "[store]<sp>path(/)"
resource_pool_name: Resources   # If you are not sure, leave as "Resources" or comment out.
esxi_host: vhost-a01
## Network port label; set either of the two (not both)
#network_name: VM Network       # For standard switch
dvs_portgroup: PROD_LAN01       # For Distributed Switch
##
cpu: 3
memory_mb: 4096
disk_format: Thick    # One of: Thick, Thin, EagerZeroedThick, or leave blank (or comment the line) to retain template's format
disks:
  - name: Hard disk 1    # Must match the virtual disk's "Name" as defined in vSphere
    size_gb: 50
  - name: Hard disk 2
    size_gb: 8
  - name: Hard disk 3
    size_gb: 5
  #- name: Hard disk 4
  #  size_gb: 3

# Swap devices: their partitions will be expanded (growpart) and the devices reinitialized (mkswap) so the swap fills the enlarged partitions.
# Use numeric-like keys (1, 2, 3, ...) to ensure stable processing order.
swaps:
  1: /dev/sdb1
 #2: /dev/sdd1

# List of device paths to expand filesystems with resize2fs after partition expansion.
# This is a kit-specific extension, as the standard cloud-init 'resizefs' module only supports the root device.
# Note: Including the root device (e.g., /dev/sda3) is optional; it will be resized by default.
resize_fs:
  - /dev/sdc1
  #- /dev/sda3

# == OS/Cloud-init Parameters ==
instance_id: original01-20251001
hostname: original01
fqdn: original01.production.local

netif1:
  netdev: ens192
  ip_addr: 192.168.0.10
  prefix: 24
  gateway: 192.168.0.254
  dnsaddresses:
    - 192.168.0.201
    - 192.168.0.202
  ignore_auto_routes: yes
  ignore_auto_dns: yes
  ipv6_disable: yes      # Set "yes" to force IPv6 method of this interface to be 'disabled', not 'ignore'

# Additional NIC example (uncomment to use)
# netif2:
#  netdev: ens224
#  ip_addr: 10.10.10.101
#  prefix: 24
#  ignore_auto_routes: yes
#  ignore_auto_dns: yes
#  ipv6_disable: yes

user1:
  name: admin01
  primary: true  # This user will be selected for in-guest operations
  groups: "wheel,adm,systemd-journal"
  password: "AdminPass123!"    # As plain string for use with PowerShell logics
  password_hash: "$6$rounds=656000$YourHashHere123$abcdef..."      # SHA-512 salted-hash string for user registration in the guest Linux: Generate using "openssl passwd -6 'password'"
  ssh_keys:
    - "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEArandomkey1... admin01@workstation"
   #- "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIrandomkey2... admin01@laptop"

#user2:
#  name: deploy01
#  password: "DeployPass456!"
#  password_hash: "$6$rounds=656000$YourHashHere456$ghijkl..."
#  groups: "wheel"
#  ssh_keys:
#    - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrandomkey3... deploy01@ci-server"

# == Script tuning parameters ==
# How long the script wait for cloud-init completion at Phase-3 (personalization)
cloudinit_wait_sec: 600        # Default:600 in the script
cloudinit_poll_sec: 10         # Default:10
cloudinit_tools_wait_sec: 60   # VMwareTools wait time in each poll failure; default:60
cloudinit_tools_poll_sec: 10   # Default:10
cloudinit_backoff_sec: 60      # Pause before the polling above starts; default:60

